FROM golang:alpine

ENV GOSUMDB=off

WORKDIR /app

COPY go.mod .
COPY go.sum .
COPY docker/go/.netrc docker/go/.netrc
RUN cp ./docker/go/.netrc $HOME/
RUN go mod download
RUN go install github.com/billizzard/go-mysql-migration@latest
RUN mv $GOPATH/bin/go-mysql-migration $GOPATH/bin/migrations

COPY . .
RUN go build -o /main .

EXPOSE 80
EXPOSE 50001

ENTRYPOINT [ "/main" ]